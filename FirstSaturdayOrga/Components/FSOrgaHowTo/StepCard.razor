<div class="@("step-card " + (IsRequiredStep ? "step-card--required" : "step-card--optional"))">
    <div class="step-icon-container">
        @if (IsRequiredStep)
        {
            <span class="step-icon step-icon--required"
                  style="--icon-url: url('@($"../icons/{IconName}.svg")');">
            </span>
        }
        else
        {
            <span class="step-icon step-icon--optional"
                  style="--icon-url: url('@($"../icons/{IconName}.svg")');">
            </span>
        }


    </div>
    <div class="step-title">
        <div class="step-title--short">@TitleShort</div>
        <div class="step-title--long">@TitleLong</div>

    </div>
    <div>
        @if (PopupContent is not null) {
            <button 
                type="button" 
                class="@("step-info-btn " + (IsRequiredStep ? "step-info-btn--required" : "step-info-btn--optional"))" 
                @onclick="Open" 
                aria-label="Meer info"
            >
                ?
            </button>
        }

    </div>
</div>

@if (_isOpen) {
    <div class="modal-container" @onclick="Close">
        <div class="modal-content" role="dialog" aria-modal="true" aria-label="@TitleShort"
             @onclick:stopPropagation="true">
            <div class="modal-header">
                <div class="step-title--short">@TitleShort</div>
                <div class="step-title--long">@TitleLong</div>
                <button type="button" class="modal-close" @onclick="Close" aria-label="Sluiten">×</button>
            </div>

            <div class="modal-body">
                @PopupContent
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public string TitleShort { get; set; } = "";
    [Parameter] public string TitleLong { get; set; } = "";
    [Parameter] public string IconName { get; set; } = "";
    [Parameter] public bool IsRequiredStep { get; set; } = true;


    [Parameter] public RenderFragment? PopupContent { get; set; }


    private bool _isOpen;

    private void Open() => _isOpen = true;
    private void Close() => _isOpen = false;
}
